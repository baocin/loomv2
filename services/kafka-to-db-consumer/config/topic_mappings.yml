schema_version: v1
defaults:
  upsert_key: device_id, timestamp
  conflict_strategy: ignore
  timestamp_field: timestamp
  device_id_field: device_id
  schema_version_field: schema_version
topics:
  device.audio.raw:
    table: device_audio_raw
    description: Raw microphone audio chunks
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      chunk_data: audio_data
      data: audio_data
      data.audio_data: audio_data
      data.chunk_data: audio_data
      chunk_number: chunk_number
      data.chunk_number: chunk_number
      format: format
      data.format: format
      sample_rate: sample_rate
      data.sample_rate: sample_rate
      channels: channels
      data.channels: channels
      duration_ms: duration_ms
      data.duration_ms: duration_ms
      metadata: metadata
      file_id: file_id
      message_id: message_id
      recorded_at: recorded_at
    data_types:
      chunk_number: integer
      sample_rate: integer
      channels: integer
      duration_ms: integer
      timestamp: timestamp
      recorded_at: timestamp
    required_fields:
    - device_id
    - timestamp
    conflict_strategy: ignore
  device.video.screen.raw:
    table: device_video_screen_raw
    description: Screen recording keyframes
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.frame_data: frame_data
      data.format: video_format
      data.width: width
      data.height: height
      data.frame_number: frame_number
      data.timestamp_ms: timestamp_ms
      metadata.app_name: app_name
      metadata.window_title: window_title
    data_types:
      width: integer
      height: integer
      frame_number: integer
      timestamp_ms: integer
      timestamp: timestamp
    transforms:
      frame_data: base64_decode
    required_fields:
    - device_id
    - timestamp
  device.image.camera.raw:
    table: device_image_camera_raw
    description: Photos from cameras and screenshots
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.image_data: image_data
      data.format: image_format
      data.width: width
      data.height: height
      data.source: source
      metadata.location.latitude: latitude
      metadata.location.longitude: longitude
      metadata.camera_model: camera_model
    data_types:
      width: integer
      height: integer
      latitude: float
      longitude: float
      timestamp: timestamp
    transforms:
      image_data: base64_decode
    required_fields:
    - device_id
    - timestamp
  device.sensor.gps.raw:
    table: device_sensor_gps_raw
    description: GPS location data from devices
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.latitude: latitude
      data.longitude: longitude
      data.altitude: altitude
      data.accuracy: accuracy
      data.speed: speed
      data.heading: bearing
      data.provider: provider
      metadata.activity: activity
      metadata.battery_level: battery_level
    data_types:
      latitude: float
      longitude: float
      altitude: float
      accuracy: float
      speed: float
      bearing: float
      battery_level: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.latitude
    - data.longitude
  device.sensor.barometer.raw:
    table: device_sensor_barometer_raw
    description: Atmospheric pressure data
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.pressure: pressure
      data.altitude: altitude
      data.unit: unit
      metadata: metadata
    data_types:
      pressure: float
      altitude: float
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.pressure
  device.sensor.temperature.raw:
    table: device_sensor_temperature_raw
    description: Device temperature readings
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.temperature: temperature
      data.unit: unit
      data.sensor_location: sensor_location
      metadata: metadata
    data_types:
      temperature: float
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.temperature
  device.sensor.accelerometer.raw:
    table: device_sensor_accelerometer_raw
    description: 3-axis motion sensor data
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      # Support both root-level and nested data fields
      x: x_axis
      y: y_axis
      z: z_axis
      data.x: x_axis
      data.y: y_axis
      data.z: z_axis
      data.magnitude: magnitude
      data.sample_rate: sample_rate
      metadata.activity: activity
      metadata.device_orientation: device_orientation
    data_types:
      x_axis: float
      y_axis: float
      z_axis: float
      magnitude: float
      sample_rate: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
  device.health.heartrate.raw:
    table: device_health_heartrate_raw
    description: Heart rate measurements
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.heart_rate: heart_rate
      data.confidence: confidence
      data.measurement_type: measurement_type
      data.variability: variability
      metadata.activity: activity
      metadata.device_model: device_model
    data_types:
      heart_rate: integer
      confidence: float
      variability: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.heart_rate
  device.health.steps.raw:
    table: device_health_steps_raw
    description: Step count data
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.step_count: step_count
      data.distance_meters: distance_meters
      data.calories_burned: calories_burned
      data.active_minutes: active_minutes
      metadata.activity_type: activity_type
      metadata.floor_count: floor_count
    data_types:
      step_count: integer
      distance_meters: float
      calories_burned: float
      active_minutes: integer
      floor_count: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.step_count
  device.state.power.raw:
    table: device_state_power_raw
    description: Device power and battery status
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.battery_level: battery_level
      data.is_charging: is_charging
      data.is_plugged_in: is_plugged_in
      data.temperature_celsius: battery_temperature
      data.voltage: voltage
      data.power_source: power_source
      data.lid_closed: lid_closed
      data.thermal_state: thermal_state
      metadata: metadata
    data_types:
      battery_level: integer
      is_charging: boolean
      is_plugged_in: boolean
      battery_temperature: float
      voltage: float
      lid_closed: boolean
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.battery_level
    - data.is_charging
  device.system.apps.macos.raw:
    table: device_system_apps_macos_raw
    description: macOS app monitoring data
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.app_name: app_name
      data.bundle_id: bundle_id
      data.duration_seconds: duration_seconds
      data.window_title: window_title
      data.is_active: is_active
      metadata.cpu_usage: cpu_usage
      metadata.memory_usage_mb: memory_usage_mb
    data_types:
      duration_seconds: integer
      is_active: boolean
      cpu_usage: float
      memory_usage_mb: float
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.app_name
  device.system.apps.android.raw:
    table: device_system_apps_android_raw
    description: Android app monitoring data
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.app_name: app_name
      data.package_name: package_name
      data.duration_seconds: duration_seconds
      data.is_foreground: is_foreground
      metadata.battery_usage: battery_usage
      metadata.data_usage_mb: data_usage_mb
    data_types:
      duration_seconds: integer
      is_foreground: boolean
      battery_usage: float
      data_usage_mb: float
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.app_name
  device.metadata.raw:
    table: device_metadata_raw
    description: Arbitrary device metadata
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.key: key
      data.value: value
      data.category: category
      metadata: metadata
    data_types:
      value: json
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.key
    - data.value
  os.events.app_lifecycle.raw:
    table: os_events_app_lifecycle_raw
    description: Application lifecycle events
    field_mappings:
      trace_id: id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.app_identifier: app_identifier
      data.app_name: app_name
      data.event_type: event_type
      data.duration_seconds: duration_seconds
      metadata: metadata
    data_types:
      duration_seconds: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.app_identifier
    - data.event_type
  os.events.system.raw:
    table: os_events_system_raw
    description: System-level OS events
    field_mappings:
      trace_id: id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.event_type: event_type
      data.event_category: event_category
      data.severity: severity
      data.description: description
      metadata: metadata
    data_types:
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.event_type
  os.events.notifications.raw:
    table: os_events_notifications_raw
    description: System notification events
    field_mappings:
      trace_id: id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.notification_id: notification_id
      data.app_identifier: app_identifier
      data.title: title
      data.body: body
      data.action: action
      metadata: metadata
    data_types:
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.notification_id
    - data.app_identifier
  device.network.wifi.raw:
    table: device_network_wifi_raw
    description: Wi-Fi connection state
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.ssid: ssid
      data.bssid: bssid
      data.signal_strength: signal_strength
      data.link_speed_mbps: link_speed_mbps
      data.frequency_mhz: frequency_mhz
      data.is_connected: is_connected
      ssid: ssid
      bssid: bssid
      signal_strength: signal_strength
      frequency: frequency
      channel: channel
      security: security_type
      security_type: security_type
      ip_address: ip_address
      link_speed: link_speed
      is_connected: is_connected
      connected: is_connected
      metadata.ip_address: ip_address
      metadata.security_type: security_type
    data_types:
      signal_strength: integer
      link_speed_mbps: integer
      frequency_mhz: integer
      is_connected: boolean
      timestamp: timestamp
    defaults:
      is_connected: false
    required_fields:
    - device_id
    - timestamp
  device.network.bluetooth.raw:
    table: device_network_bluetooth_raw
    description: Nearby Bluetooth devices
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.device_address: device_address
      data.device_name: device_name
      data.rssi: rssi
      data.device_type: device_type
      metadata.is_connected: is_connected
      metadata.services: services
    data_types:
      rssi: integer
      is_connected: boolean
      services: array
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
  digital.clipboard.raw:
    table: digital_clipboard_raw
    description: Clipboard content
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.content: content
      data.content_type: content_type
      data.source_app: source_app
      metadata.content_length: content_length
      metadata.has_formatting: has_formatting
    data_types:
      content_length: integer
      has_formatting: boolean
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
  external.twitter.liked.raw:
    table: twitter_posts
    description: Liked tweets from Twitter/X
    upsert_key: tweet_id
    conflict_strategy: update
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.tweet_id: tweet_id
      data.tweet_url: tweet_url
      data.tweet_text: tweet_text
      data.author_username: author_username
      data.author_display_name: author_display_name
      data.created_at: created_at_twitter
      data.like_count: like_count
      data.retweet_count: retweet_count
      data.reply_count: reply_count
      data.is_retweet: is_retweet
      data.has_media: has_media
      data.media_urls: media_urls
      metadata.fetched_at: liked_at
      metadata.user_agent: user_agent
    data_types:
      like_count: integer
      retweet_count: integer
      reply_count: integer
      is_retweet: boolean
      has_media: boolean
      media_urls: array
      created_at_twitter: timestamp
      liked_at: timestamp
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.tweet_id
    - data.tweet_text
  external.calendar.events.raw:
    table: external_calendar_events_raw
    description: Calendar events
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.event_id: event_id
      data.title: title
      data.description: description
      data.start_time: start_time
      data.end_time: end_time
      data.location: location
      data.attendees: attendees
      metadata.calendar_name: calendar_name
      metadata.is_recurring: is_recurring
    data_types:
      start_time: timestamp
      end_time: timestamp
      attendees: array
      is_recurring: boolean
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.event_id
  external.email.events.raw:
    table: external_email_events_raw
    description: Email events from all IMAP accounts
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.email_id: email_id
      data.subject: subject
      data.sender: sender
      data.recipients: recipients
      data.body_preview: body_preview
      data.has_attachments: has_attachments
      metadata.account_name: account_name
      metadata.folder: folder
    data_types:
      recipients: array
      has_attachments: boolean
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.email_id
  media.audio.vad_filtered:
    table: media_audio_voice_segments_raw
    description: Audio segments identified as containing speech
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.audio_data: segment_audio_data
      data.format: audio_format
      data.sample_rate: audio_sample_rate
      data.channels: audio_channels
      data.duration_ms: duration_ms
      data.speech_probability: confidence_score
      data.start_time: segment_start_time
      data.end_time: segment_end_time
      metadata.vad_model: model_version
      metadata.processing_time_ms: processing_time_ms
    data_types:
      audio_sample_rate: integer
      audio_channels: integer
      duration_ms: integer
      confidence_score: float
      segment_start_time: integer
      segment_end_time: integer
      processing_time_ms: integer
      timestamp: timestamp
    transforms:
      segment_audio_data: base64_decode
    required_fields:
    - device_id
    - timestamp
  media.text.transcribed.words:
    table: media_text_word_timestamps_raw
    description: Word-by-word speech transcription with timestamps
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.transcript: full_transcript
      data.language: language_code
      data.duration_seconds: duration_seconds
      data.audio_trace_id: audio_trace_id
      metadata.asr_model: model_version
      metadata.processing_time_ms: processing_time_ms
    data_types:
      duration_seconds: float
      processing_time_ms: integer
      timestamp: timestamp
    array_mappings:
      data.words:
        table_column_prefix: word_
        element_mappings:
          word: word_text
          start: start_time_ms
          end: end_time_ms
          confidence: confidence_score
        sequence_field: word_sequence
    required_fields:
    - device_id
    - timestamp
  media.image.analysis.minicpm_results:
    table: media_image_analysis_minicpm_results
    description: Vision-language analysis results
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.image_trace_id: image_trace_id
      data.caption: caption
      data.objects_detected: objects_detected
      data.text_detected: text_detected
      data.scene_description: scene_description
      metadata.model_version: model_version
      metadata.processing_time_ms: processing_time_ms
    data_types:
      objects_detected: array
      processing_time_ms: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
  analysis.audio.emotion_results:
    table: analysis_audio_emotion_scores_raw
    description: Speech emotion recognition results
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.audio_trace_id: audio_trace_id
      data.emotion_scores: emotion_scores
      data.dominant_emotion: dominant_emotion
      data.confidence: confidence
      metadata.model_version: model_version
      metadata.processing_time_ms: processing_time_ms
    data_types:
      emotion_scores: json
      confidence: float
      processing_time_ms: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
  analysis.text.embedded.emails:
    table: emails_with_embeddings
    description: Email content with text embeddings
    upsert_key: email_id
    conflict_strategy: update
    field_mappings:
      trace_id: trace_id
      email_id: email_id
      device_id: device_id
      timestamp: timestamp
      data.subject: subject
      data.body_text: body_text
      data.embedding: embedding
      data.embedding_model: model
      data.embedding_dimensions: dimensions
      metadata.processing_time_ms: processing_time_ms
    data_types:
      embedding: float_array
      dimensions: integer
      processing_time_ms: integer
      timestamp: timestamp
    required_fields:
    - email_id
    - data.embedding
  analysis.text.embedded.twitter:
    table: twitter_posts
    description: Twitter content with text embeddings - updates existing records
    upsert_key: tweet_id
    conflict_strategy: update
    field_mappings:
      trace_id: trace_id
      tweet_id: tweet_id
      device_id: device_id
      timestamp: timestamp
      data.embedding: embedding
      data.embedding_model: embedding_model
      data.embedding_dimensions: embedding_dimensions
      metadata.processing_time_ms: processing_time_ms
    data_types:
      embedding: float_array
      embedding_dimensions: integer
      processing_time_ms: integer
      timestamp: timestamp
    required_fields:
    - tweet_id
    - data.embedding
  analysis.text.embedded.notifications:
    table: analysis_text_embedded_notifications
    description: System notification embeddings
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: time
      schema_version: schema_version
      data.notification_id: notification_id
      data.source: source
      data.title: title
      data.content: content
      data.embedding: embedding
      data.embedding_model: embedding_model
      data.embedding_dimensions: embedding_dimensions
      metadata: metadata
    data_types:
      embedding: float_array
      embedding_dimensions: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.content
    - data.embedding
  analysis.text.embedded.notes:
    table: analysis_text_embedded_notes
    description: Digital notes embeddings including OCR results
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: time
      schema_version: schema_version
      data.note_id: note_id
      data.source: source
      data.title: title
      data.content: content
      data.ocr_content: ocr_content
      data.embedding: embedding
      data.embedding_model: embedding_model
      data.embedding_dimensions: embedding_dimensions
      metadata: metadata
    data_types:
      embedding: float_array
      embedding_dimensions: integer
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.content
    - data.embedding
  digital.notes.raw:
    table: digital_notes_raw
    description: Raw digital notes from various apps
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.note_id: note_id
      data.source_app: source_app
      data.title: title
      data.content: content
      data.has_images: has_images
      data.image_urls: image_urls
      data.created_at: created_at
      data.updated_at: updated_at
      metadata.tags: tags
      metadata.folder: folder
    data_types:
      has_images: boolean
      image_urls: array
      created_at: timestamp
      updated_at: timestamp
      tags: array
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.note_id
    - data.content
  task.url.ingest:
    table: task_url_ingest
    description: URLs to be processed
    upsert_key: trace_id
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.url: url
      data.source: source
      data.priority: priority
      metadata.referrer: referrer
      metadata.tags: tags
    data_types:
      priority: integer
      tags: array
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.url
  location.address.geocoded:
    table: location_address_geocoded
    description: Geocoded addresses from GPS coordinates
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.latitude: latitude
      data.longitude: longitude
      data.formatted_address: formatted_address
      data.components.city: city
      data.components.state: state
      data.components.country: country
      data.components.postal_code: postal_code
      data.components.street: street
      data.components.house_number: house_number
      data.confidence: confidence
      data.geocoding_provider: geocoding_provider
      metadata.original_gps_trace_id: original_gps_trace_id
    data_types:
      latitude: float
      longitude: float
      confidence: float
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.latitude
    - data.longitude
    - data.formatted_address
  motion.events.significant:
    table: motion_events_significant
    description: Significant motion events detected from accelerometer
    field_mappings:
      trace_id: event_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.start_time: start_time
      data.end_time: end_time
      data.duration_seconds: duration_seconds
      data.motion_type: motion_type
      data.confidence: confidence
      data.max_acceleration: max_acceleration
      data.avg_acceleration: avg_acceleration
      data.dominant_axis: dominant_axis
      data.activity_type: activity_type
      data.activity_confidence: activity_confidence
      data.sample_count: sample_count
      data.raw_data_summary: raw_data_summary
    data_types:
      duration_seconds: float
      confidence: float
      max_acceleration: float
      avg_acceleration: float
      activity_confidence: float
      sample_count: integer
      raw_data_summary: json
      start_time: timestamp
      end_time: timestamp
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.motion_type
    - data.confidence
  motion.classification.activity:
    table: motion_classification_activity
    description: Classified user activities from combined sensor data
    field_mappings:
      trace_id: message_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.activity_type: activity_type
      data.confidence: confidence
      data.location_context: location_context
      data.start_time: start_time
      data.end_time: end_time
      data.duration_seconds: duration_seconds
      data.motion_events_count: motion_events_count
      data.step_count: step_count
      data.distance_meters: distance_meters
      data.avg_speed_ms: avg_speed_ms
      data.max_speed_ms: max_speed_ms
      data.start_location: start_location
      data.end_location: end_location
      data.metrics: metrics
      data.source_events: source_events
    data_types:
      confidence: float
      duration_seconds: float
      motion_events_count: integer
      step_count: integer
      distance_meters: float
      avg_speed_ms: float
      max_speed_ms: float
      start_location: json
      end_location: json
      metrics: json
      source_events: array
      start_time: timestamp
      end_time: timestamp
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.activity_type
    - data.confidence
  location.georegion.detected:
    table: location_georegion_detected
    description: Detected presence in saved georegions
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      data.georegion_id: georegion_id
      data.georegion_name: georegion_name
      data.georegion_type: georegion_type
      data.latitude: latitude
      data.longitude: longitude
      data.distance_to_center_meters: distance_to_center_meters
      data.confidence_score: confidence_score
      data.entry_time: entry_time
      data.exit_time: exit_time
      metadata.trigger_source: trigger_source
    data_types:
      latitude: float
      longitude: float
      distance_to_center_meters: float
      confidence_score: float
      entry_time: timestamp
      exit_time: timestamp
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - data.georegion_id
    - data.georegion_name
    - data.latitude
    - data.longitude
  device.app_usage.android.aggregated:
    table: device_app_usage_android_aggregated
    description: Pre-aggregated Android app usage statistics
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      message_id: message_id
      aggregation_period_start: aggregation_period_start
      aggregation_period_end: aggregation_period_end
      aggregation_interval_minutes: aggregation_interval_minutes
      total_screen_time_ms: total_screen_time_ms
      total_unlocks: total_unlocks
      services_encountered: services_encountered
    data_types:
      aggregation_interval_minutes: integer
      total_screen_time_ms: integer
      total_unlocks: integer
      aggregation_period_start: timestamp
      aggregation_period_end: timestamp
      services_encountered: array
      timestamp: timestamp
    array_mappings:
      app_usage_stats:
        table: device_app_usage_android_stats
        foreign_key_mapping:
          device_id: device_id
          aggregation_period_start: aggregation_period_start
        element_mappings:
          package_name: package_name
          app_name: app_name
          total_time_foreground_ms: total_time_foreground_ms
          last_time_used: last_time_used
          last_time_foreground_service_used: last_time_foreground_service_used
          total_time_foreground_service_used_ms: total_time_foreground_service_used_ms
          launch_count: launch_count
      app_event_stats:
        table: device_app_usage_android_events
        foreign_key_mapping:
          device_id: device_id
          aggregation_period_start: aggregation_period_start
        element_mappings:
          package_name: package_name
          event_type: event_type
          event_count: event_count
          last_event_time: last_event_time
      screen_time_by_category:
        table: device_app_usage_android_categories
        foreign_key_mapping:
          device_id: device_id
          aggregation_period_start: aggregation_period_start
        element_mappings:
          category: category
          total_time_ms: total_time_ms
          app_count: app_count
          percentage_of_total: percentage_of_total
      notification_stats:
        table: device_app_usage_android_notifications
        foreign_key_mapping:
          device_id: device_id
          aggregation_period_start: aggregation_period_start
        element_mappings:
          package_name: package_name
          notification_count: notification_count
          interaction_count: interaction_count
          dismissal_count: dismissal_count
    required_fields:
    - device_id
    - timestamp
    - aggregation_period_start
    - aggregation_period_end
    - total_screen_time_ms
  device.app_usage.android.events:
    table: device_app_usage_android_events_individual
    description: Individual Android app event data
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      message_id: message_id
      recorded_at: recorded_at
      package_name: package_name
      app_name: app_name
      event_type: event_type
      class_name: class_name
      configuration: configuration
      shortcut_id: shortcut_id
      standby_bucket: standby_bucket
      notification_channel_id: notification_channel_id
      metadata: metadata
    data_types:
      standby_bucket: integer
      configuration: json
      metadata: json
      recorded_at: timestamp
      timestamp: timestamp
    required_fields:
    - device_id
    - timestamp
    - package_name
    - event_type
  device.app_usage.android.categories:
    table: device_app_usage_android_categories_aggregated
    description: Android app usage statistics grouped by category
    field_mappings:
      trace_id: trace_id
      device_id: device_id
      timestamp: timestamp
      schema_version: schema_version
      message_id: message_id
      aggregation_period_start: aggregation_period_start
      aggregation_period_end: aggregation_period_end
      total_screen_time_ms: total_screen_time_ms
      device_unlocks: device_unlocks
      metadata: metadata
    data_types:
      aggregation_period_start: timestamp
      aggregation_period_end: timestamp
      total_screen_time_ms: integer
      device_unlocks: integer
      metadata: json
      timestamp: timestamp
    array_mappings:
      category_stats:
        table: device_app_usage_android_categories_detail
        foreign_key_mapping:
          device_id: device_id
          aggregation_period_start: aggregation_period_start
        element_mappings:
          category: category
          total_time_ms: total_time_ms
          app_count: app_count
          percentage_of_total: percentage_of_total
    required_fields:
    - device_id
    - timestamp
    - aggregation_period_start
    - aggregation_period_end
    - total_screen_time_ms
transformations:
  base64_decode:
    description: Decode base64 string to bytes
    input_type: string
    output_type: bytes
  timestamp_parse:
    description: Parse ISO timestamp string to PostgreSQL timestamp
    input_type: string
    output_type: timestamp
  json_stringify:
    description: Convert object to JSON string
    input_type: object
    output_type: string
data_type_mappings:
  string: TEXT
  integer: INTEGER
  float: REAL
  boolean: BOOLEAN
  timestamp: TIMESTAMPTZ
  bytes: BYTEA
  array: TEXT[]
  float_array: REAL[]
  json: JSONB
